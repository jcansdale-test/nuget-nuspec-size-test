on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        files: [1, 1000, 1023, 1025, 1100, 1110, 1120, 1130, 1131, 1132, 1140, 1150, 1200, 1250, 1300, 1500, 1800, 2000]

    steps:
      - run: |
          mkdir content
          cat > ./content/Protoculture.Postgres.Embedded.nuspec << EOM
          <?xml version="1.0" encoding="utf-8"?> /
          <package xmlns="http://schemas.microsoft.com/packaging/2013/05/nuspec.xsd">
            <metadata>
              <id>nuget-nuspec-size-test</id>
              <version>0.${{ github.run_number }}.${{ matrix.files }}</version> 
              <repository type="git" url="https://github.com/${{ github.repository }}" />
            </metadata>
          </package>
          EOM
          
          for i in {1..${{ matrix.files }}}
          do
            echo '<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->' >> ./content/Protoculture.Postgres.Embedded.nuspec
          done

      - run: |
          cd content
          zip -r ../package.nupkg .
 
      - run: ls -lh ./content/Protoculture.Postgres.Embedded.nuspec

      - run: dotnet nuget push package.nupkg -s https://nuget.pkg.github.com/${{ github.repository_owner }} -k ${{ secrets.GITHUB_TOKEN }}
